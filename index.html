<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Excel Migration Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #e0e0e0;
    margin: 0;
}
header {
    background: #1f1f1f;
    color: #00e676;
    padding: 15px 20px;
    font-size: 1.6rem;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
}
main {
    display: flex;
    flex-wrap: wrap;
    padding: 20px;
    gap: 20px;
}
.sidebar {
    width: 280px;
    background: #1a1a1a;
    padding: 15px;
    border-radius: 10px;
    color: #e0e0e0;
    display: flex;
    flex-direction: column;
    gap: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.6);
}
.sidebar button, .sidebar input {
    padding: 10px;
    font-size: 1rem;
    border-radius: 5px;
    border: none;
    cursor: pointer;
}
.sidebar button {
    background: #00e676;
    color: #121212;
    font-weight: bold;
    transition: 0.2s;
}
.sidebar button:hover {
    background: #00c853;
}
.sidebar input {
    background: #2a2a2a;
    color: #e0e0e0;
}
.content {
    flex: 1;
    min-width: 300px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: calc(100vh - 60px); /* Fill viewport minus header height */
}

table {
    width: 100%;
    border-collapse: collapse;
    background: #1f1f1f;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
}
th, td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #333;
}
th {
    background: #333;
    color: #00e676;
    position: sticky;
    top: 0;
}
tr:nth-child(even) {
    background: #1a1a1a;
}
tr:hover {
    background: #333;
}
.scrollable {
    flex: 1;           /* Grow to fill remaining space */
    overflow-y: auto;  /* Scroll if content exceeds height */
    border-radius: 10px;
}

.debit { color: #00e676; font-weight: bold; }
.credit { color: #ff5252; font-weight: bold; }
.highlight { background: #ff9800 !important; color: #000; }
@media(max-width: 768px){
    main { flex-direction: column; }
    .sidebar { width: 100%; }
}

    .tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}
.tabButton {
  padding: 10px 20px;
  background: #1a1a1a;
  color: #e0e0e0;
  border: none;
  border-radius: 5px 5px 0 0;
  cursor: pointer;
  font-weight: bold;
  transition: 0.2s;
}
.tabButton.active {
  background: #00e676;
  color: #121212;
}
.tabButton:hover {
  background: #00c853;
}
.tabContent {
  display: none;
}

</style>
</head>
<body>

<header>LEDGIOX</header>
<main>
  <div class="sidebar">
    <label for="counterAccount">Counter Account</label>
    <input type="text" id="counterAccount" placeholder="Counter Account e.g. Bank">
    <label for="fileInput">Upload Excel/CSV</label>
    <input type="file" id="fileInput" accept=".xlsx,.csv">
    <button onclick="loadExcel()">Load Excel</button>
    <button onclick="generateJournal()">Generate Journal</button>
    <button onclick="generateLedger()">Generate General Ledger</button>
    <button onclick="downloadJournal()">Download Journal</button>
    <button onclick="downloadLedger()">Download Ledger</button>
    <button onclick="downloadSample()">Download Sample Excel</button>
    <label for="platformSelect">Export to Platform</label>
    <select id="platformSelect">
      <option value="">Select Platform</option>
      <option value="zoho">Zoho Books</option>
      <option value="quickbooks">QuickBooks</option>
      <option value="sage">Sage</option>
    </select>
    <button onclick="exportPlatform()">Export CSV</button>
  </div>

  <div class="content">
    <!-- Tabs -->
    <div class="tabs">
      <button class="tabButton active" onclick="openTab(event, 'sampleTab')">Sample Excel</button>
      <button class="tabButton" onclick="openTab(event, 'journalTab')">Journal Entries</button>
      <button class="tabButton" onclick="openTab(event, 'ledgerTab')">General Ledger</button>
    </div>

<div id="sampleTab" class="tabContent">
  <table id="sampleTable">
      <tr><th>Date</th><th>Description</th><th>Type</th><th>Amount</th><th>Account</th><th>Code Range</th><th>Category</th></tr>
  </table>
</div>

<div id="journalTab" class="tabContent">
  <div class="scrollable">
    <table id="journalTable">
        <tr><th>Date</th><th>Account</th><th>Code Range</th><th>Category</th><th>Debit</th><th>Credit</th><th>Description</th></tr>
    </table>
  </div>
</div>

<div id="ledgerTab" class="tabContent">
  <div class="scrollable">
    <table id="ledgerTable">
        <tr><th>Account</th><th>Code Range</th><th>Category</th><th>Date</th><th>Description</th><th>Debit</th><th>Credit</th><th>Balance</th></tr>
    </table>
  </div>
</div>

  </div>
</main>


<script>
let sheetData = [];
let journal = [];
let ledger = {};

const sampleData = [
  {Date:"2025-08-01", Description:"Office Supplies Purchase", Type:"Payment", Amount:120, Account:"Stationery"},
  {Date:"2025-08-02", Description:"Staff Lunch", Type:"Payment", Amount:45, Account:"Staff Food"},
  {Date:"2025-08-03", Description:"Legal Consultation", Type:"Payment", Amount:300, Account:"Legal"},
  {Date:"2025-08-04", Description:"Product Sale", Type:"Receipt", Amount:500, Account:"Sales"},
  {Date:"2025-08-05", Description:"Car Fuel", Type:"Payment", Amount:60, Account:"Car Fix"},
  {Date:"2025-08-06", Description:"Asset Purchased – Computer", Type:"Payment", Amount:800, Account:"Assets"},
  {Date:"2025-08-07", Description:"Asset Sold – Printer", Type:"Receipt", Amount:200, Account:"Assets"},
  {Date:"2025-08-08", Description:"Discount Received", Type:"Receipt", Amount:50, Account:"Discount Received"},
  {Date:"2025-08-09", Description:"Stationery Purchase", Type:"Payment", Amount:70, Account:"Stationery"},
  {Date:"2025-08-10", Description:"Staff Snacks", Type:"Payment", Amount:30, Account:"Staff Food"},
  {Date:"2025-08-11", Description:"Sales Returned – Product A", Type:"Payment", Amount:100, Account:"Sales Returns"},
  {Date:"2025-08-12", Description:"Legal Fee", Type:"Payment", Amount:250, Account:"Legal"},
  {Date:"2025-08-13", Description:"Printing Flyers", Type:"Payment", Amount:150, Account:"Printing"},
  {Date:"2025-08-14", Description:"Misc Expenses", Type:"Payment", Amount:60, Account:"Misc"},
  {Date:"2025-08-15", Description:"Owner Capital Contribution", Type:"Receipt", Amount:1000, Account:"Capital"},
  {Date:"2025-08-16", Description:"Owner Drawing", Type:"Payment", Amount:200, Account:"Drawings"},
  {Date:"2025-08-17", Description:"Bank Interest Income", Type:"Receipt", Amount:75, Account:"Income"},
  {Date:"2025-08-18", Description:"Loan Repayment", Type:"Payment", Amount:500, Account:"Liabilities"}
];

const improvedAccountCodes = {
  Asset: { min: 1000, max: 1999, description: "Current & Fixed Assets" },
  Liability: { min: 2000, max: 2999, description: "Current & Long-term Liabilities" },
  Equity: { min: 3000, max: 3999, description: "Owner's Equity & Capital" },
  Revenue: { min: 4000, max: 4499, description: "Operating & Other Revenue" },
  "Contra Revenue": { min: 4500, max: 4599, description: "Returns & Discounts" },
  "Operating Expense": { min: 5000, max: 5999, description: "Direct Operating Costs" },
  "Administrative Expense": { min: 6000, max: 6999, description: "Admin & Overhead Costs" }
};

const improvedAccountMapping = {
  "office supplies": 5000, "stationery": 5010, "supplies": 5000, "paper": 5010, "pens": 5010,
  "staff food": 5400, "staff meal": 5400, "staff lunch": 5400, "staff dinner": 5400, "lunch": 5400, "snacks": 5400, "coffee": 5400,
  "legal": 5300, "lawyer": 5300, "attorney": 5300, "consultation": 5300, "professional": 5300, "audit": 5300,
  "fuel": 5500, "petrol": 5500, "gas": 5500, "car": 5500, "transport": 5500, "taxi": 5500, "uber": 5500, "travel": 5500,
  "printing": 5600, "flyers": 5600, "brochure": 5600, "marketing": 5600, "advertising": 5600,
  "computer": 1500, "laptop": 1500, "equipment": 1500, "furniture": 1600, "asset": 1500, "purchase": 1500,
  "sale": 4000, "income": 4000, "revenue": 4000, "service": 4100,
  "return": 4500, "refund": 4500, "discount received": 4300,
  "capital": 3000, "investment": 3000, "drawing": 3200, "withdrawal": 3200,
  "loan": 2500, "debt": 2500, "payable": 2000,
  "bank": 1010, "cash": 1000, "interest": 4200, "bank charges": 6200,
  "rent": 5100, "electricity": 5200, "water": 5200, "internet": 5200, "phone": 5200,
  "misc": 5900, "miscellaneous": 5900, "other": 5900
};



    const standardChartOfAccounts = {
  "1000": { name: "Cash in Hand", category: "Current Assets", type: "Asset" },
  "1010": { name: "Cash at Bank", category: "Current Assets", type: "Asset" },
  "1020": { name: "Petty Cash", category: "Current Assets", type: "Asset" },
  "1100": { name: "Accounts Receivable", category: "Current Assets", type: "Asset" },
  "1200": { name: "Inventory", category: "Current Assets", type: "Asset" },
  "1300": { name: "Prepaid Expenses", category: "Current Assets", type: "Asset" },
  "1500": { name: "Equipment", category: "Fixed Assets", type: "Asset" },
  "1510": { name: "Accumulated Depreciation - Equipment", category: "Fixed Assets", type: "Asset" },
  "1600": { name: "Furniture & Fixtures", category: "Fixed Assets", type: "Asset" },
  "1610": { name: "Accumulated Depreciation - Furniture", category: "Fixed Assets", type: "Asset" },
  "2000": { name: "Accounts Payable", category: "Current Liabilities", type: "Liability" },
  "2100": { name: "Accrued Expenses", category: "Current Liabilities", type: "Liability" },
  "2200": { name: "Short-term Loans", category: "Current Liabilities", type: "Liability" },
  "2500": { name: "Long-term Loans", category: "Long-term Liabilities", type: "Liability" },
  "3000": { name: "Owner's Capital", category: "Owner's Equity", type: "Equity" },
  "3100": { name: "Retained Earnings", category: "Owner's Equity", type: "Equity" },
  "3200": { name: "Owner's Drawings", category: "Owner's Equity", type: "Equity" },
  "4000": { name: "Sales Revenue", category: "Operating Revenue", type: "Revenue" },
  "4100": { name: "Service Revenue", category: "Operating Revenue", type: "Revenue" },
  "4200": { name: "Interest Income", category: "Other Revenue", type: "Revenue" },
  "4300": { name: "Discount Received", category: "Other Revenue", type: "Revenue" },
  "4500": { name: "Sales Returns", category: "Contra Revenue", type: "Contra Revenue" },
  "4510": { name: "Sales Discounts", category: "Contra Revenue", type: "Contra Revenue" },
  "5000": { name: "Office Supplies", category: "Operating Expenses", type: "Expense" },
  "5010": { name: "Stationery", category: "Operating Expenses", type: "Expense" },
  "5100": { name: "Rent Expense", category: "Operating Expenses", type: "Expense" },
  "5200": { name: "Utilities", category: "Operating Expenses", type: "Expense" },
  "5300": { name: "Legal & Professional", category: "Operating Expenses", type: "Expense" },
  "5400": { name: "Staff Meals", category: "Operating Expenses", type: "Expense" },
  "5500": { name: "Travel & Transport", category: "Operating Expenses", type: "Expense" },
  "5600": { name: "Printing & Marketing", category: "Operating Expenses", type: "Expense" },
  "5700": { name: "Depreciation Expense", category: "Operating Expenses", type: "Expense" },
  "5800": { name: "Bad Debt Expense", category: "Operating Expenses", type: "Expense" },
  "5900": { name: "Miscellaneous Expenses", category: "Operating Expenses", type: "Expense" },
  "6000": { name: "Salaries & Wages", category: "Administrative Expenses", type: "Expense" },
  "6100": { name: "Insurance", category: "Administrative Expenses", type: "Expense" },
  "6200": { name: "Bank Charges", category: "Administrative Expenses", type: "Expense" },
  "6300": { name: "Interest Expense", category: "Administrative Expenses", type: "Expense" }
};


// --- Detect Account safely ---
function detectAccount(description) {
    const lower = description ? description.toLowerCase() : "";
    for (const acc in accountMapping) {
        if (lower.includes(acc.toLowerCase())) return acc;
    }
    return "Misc";
}

// --- Get category from code ---
function getAccountTypeByCode(code) {
    for (const [type, range] of Object.entries(accountCodes)) {
        if (code >= range.min && code <= range.max) return type;
    }
    return "Unknown";
}

// --- Format Excel/Date ---
function formatDate(excelDate) {
    if (!excelDate) return "";
    if (!isNaN(excelDate)) {
        const jsDate = new Date((excelDate - 25569) * 86400 * 1000);
        return jsDate.toISOString().split("T")[0];
    }
    const parts = excelDate.split(/[-\/]/);
    if (parts.length === 3) {
        let day, month, year;
        if (parts[0].length === 4) [year, month, day] = parts;
        else [day, month, year] = parts;
        const parsed = new Date(`${year}-${month}-${day}`);
       if (!isNaN(parsed.getTime())) return parsed.toISOString().split("T")[0];
    }
    const fallback = new Date(excelDate);
    return !isNaN(fallback) ? fallback.toISOString().split("T")[0] : "";
}

// --- Populate sample table ---
// --- Populate Sample Table with General Code Range ---
function populateSample() {
    const table = document.getElementById('sampleTable');
    table.innerHTML = `<tr>
        <th>Date</th>
        <th>Description</th>
        <th>Type</th>
        <th>Amount</th>
        <th>Account</th>
        <th>Code Range</th>
        <th>Category</th>
    </tr>`;

    sampleData.forEach(row => {
        const code = accountMapping[row.Account] || 0;
        const category = getAccountTypeByCode(code);
        let range = '';
        if(category && accountCodes[category]){
            range = `${accountCodes[category].min} - ${accountCodes[category].max}`;
        }

      const tr = document.createElement('tr');
tr.innerHTML = `<td>${row.Date}</td>
                <td>${row.Description}</td>
                <td>${row.Type}</td>
                <td>${row.Amount}</td>
                <td>${row.Account}</td>
                <td>${range}</td>
                <td>${category}</td>`;

// ✅ Add this here:
if(row.Account.toLowerCase() === "misc") {
    tr.classList.add("highlight");
    tr.title = "Account not recognized; please review!";
}

table.appendChild(tr);

    });
}



function validateSheet(data){
    const required = ["Date","Description","Type","Amount"];
    for(const row of data){
        for(const key of required){
            if(!(key in row) || row[key]==="") return false;
        }
    }
    return true;
}

function loadExcel() {
    const file = document.getElementById('fileInput').files[0];
    if(!file){ alert("Select a file first!"); return; }
    const reader = new FileReader();
    reader.onload = function(e){
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data,{type:"array"});
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
        if(!validateSheet(jsonData)){ alert("Excel missing required columns!"); return; }
        sheetData = jsonData;
        displaySheet(sheetData);
        alert("Excel loaded successfully!");
    }
    reader.readAsArrayBuffer(file);
}

function displaySheet(data){
    const table = document.getElementById('sampleTable');
    table.innerHTML = `<tr>
        <th>Date</th><th>Description</th><th>Type</th><th>Amount</th>
        <th>Account</th><th>Code Range</th><th>Category</th>
    </tr>`;
    data.forEach(row => {
        const account = detectAccount(row.Description);
        const category = getAccountTypeByCode(accountMapping[account] || 0);
        const range = getCodeRange(account);

        const tr = document.createElement('tr');
tr.innerHTML = `<td>${formatDate(row.Date)}</td>
                <td>${row.Description}</td>
                <td>${row.Type}</td>
                <td>${row.Amount}</td>
                <td>${account}</td>
                <td>${range}</td>
                <td>${category}</td>`;

// ✅ Add this here:
if(account.toLowerCase() === "misc") {
    tr.classList.add("highlight");
    tr.title = "Account not recognized; please review!";
}

table.appendChild(tr);

    });
}


 

function generateJournal(){
    if(sheetData.length===0){ alert("Load data first!"); return; }
    journal = [];
    ledger = {};
    const counterAccount = document.getElementById('counterAccount').value || "Cash";

    sheetData.forEach(row => {
        const acc = detectAccount(row.Description);
        const code = accountMapping[acc] || 0;
        const category = getAccountTypeByCode(code);
        const amount = parseFloat(row.Amount);
        const date = formatDate(row.Date);

        if(row.Type.toLowerCase()==="payment"){
            journal.push({Date:date,Account:acc,Code:code,Category:category,Debit:amount,Credit:0,Description:row.Description});
            journal.push({Date:date,Account:counterAccount,Code:0,Category:"Cash",Debit:0,Credit:amount,Description:row.Description});
        } else {
            journal.push({Date:date,Account:counterAccount,Code:0,Category:"Cash",Debit:amount,Credit:0,Description:row.Description});
            journal.push({Date:date,Account:acc,Code:code,Category:category,Debit:0,Credit:amount,Description:row.Description});
        }
    });
    displayJournal();
    alert("Journal generated!");
}

function displayJournal() {
    const table = document.getElementById('journalTable');
    table.innerHTML = '<tr><th>Date</th><th>Account</th><th>Code Range</th><th>Category</th><th>Debit</th><th>Credit</th><th>Description</th></tr>';

    const fragment = document.createDocumentFragment();
    journal.forEach(entry => {
        const range = getCodeRange(entry.Account);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${entry.Date}</td>
                        <td>${entry.Account}</td>
                        <td>${range}</td>
                        <td>${entry.Category}</td>
                        <td class="debit">${entry.Debit || ''}</td>
                        <td class="credit">${entry.Credit || ''}</td>
                        <td>${entry.Description}</td>`;
        fragment.appendChild(tr);
    });
    table.appendChild(fragment);
}



function generateLedger(){
    if(journal.length===0){ alert("Generate journal first!"); return; }
    ledger = {};
    journal.forEach(entry => {
        if(!ledger[entry.Account]) ledger[entry.Account] = [];
        ledger[entry.Account].push({...entry});
    });
    displayLedger();
    alert("General Ledger generated!");
}

function displayLedger() {
    const table = document.getElementById('ledgerTable');
    table.innerHTML = '<tr><th>Account</th><th>Code Range</th><th>Category</th><th>Date</th><th>Description</th><th>Debit</th><th>Credit</th><th>Balance</th></tr>';

    const fragment = document.createDocumentFragment();
    for (const acc in ledger) {
        let balance = 0;
        ledger[acc].forEach(entry => {
            balance += (entry.Debit || 0) - (entry.Credit || 0);
            const range = getCodeRange(entry.Account);
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${entry.Account}</td>
                            <td>${range}</td>
                            <td>${entry.Category}</td>
                            <td>${entry.Date}</td>
                            <td>${entry.Description}</td>
                            <td class="debit">${(entry.Debit||0).toFixed(2)}</td>
                            <td class="credit">${(entry.Credit||0).toFixed(2)}</td>
                            <td>${balance.toFixed(2)}</td>`;
            fragment.appendChild(tr);
        });
    }
    table.appendChild(fragment);
}

function downloadJournal(){
    if(journal.length===0){ 
        alert("Generate journal first!"); 
        return; 
    }

    const exportData = journal.map(entry => ({
        Date: entry.Date,
        Account: entry.Account,
        CodeRange: getCodeRange(entry.Account),
        Category: entry.Category,
        Debit: entry.Debit,
        Credit: entry.Credit,
        Description: entry.Description
    }));

    const ws = XLSX.utils.json_to_sheet(exportData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Journal");
    XLSX.writeFile(wb, "Journal.xlsx");
}

function downloadLedger(){
    if(Object.keys(ledger).length === 0){
        alert("Generate ledger first!");
        return;
    }

    const monthlyLedger = {};

  for(const acc in ledger){
    ledger[acc].forEach(entry => {
        const dateObj = new Date(entry.Date);
        const ym = `${dateObj.getFullYear()}-${String(dateObj.getMonth()+1).padStart(2,'0')}`;
        if(!monthlyLedger[ym]) monthlyLedger[ym] = [];

        // calculate balance separately inside each month
        let balance = 0;
        monthlyLedger[ym].push({
            Account: acc,
            CodeRange: getCodeRange(acc),
            Category: entry.Category,
            Date: entry.Date,
            Description: entry.Description,
            Debit: entry.Debit || 0,
            Credit: entry.Credit || 0,
            Balance: 0 // placeholder, we’ll recalc below
        });
    });
}

// Recalculate balance per month
for(const ym in monthlyLedger){
    let balances = {};
    monthlyLedger[ym] = monthlyLedger[ym].map(entry => {
        if(!balances[entry.Account]) balances[entry.Account] = 0;
        balances[entry.Account] += (entry.Debit || 0) - (entry.Credit || 0);
        return {...entry, Balance: balances[entry.Account]};
    });
}


    for(const month in monthlyLedger){
        const ws = XLSX.utils.json_to_sheet(monthlyLedger[month]);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Ledger");
        XLSX.writeFile(wb, `Ledger_${month}.xlsx`);
    }

    alert("Ledger exported as monthly files!");
}


function exportPlatform() {
    if (!journal || journal.length === 0) {
        alert("No journal data to export!");
        return;
    }

    const platform = document.getElementById("platformSelect").value;
    if (!platform) { 
        alert("Select a platform!"); 
        return; 
    }

    let exportData = [];

    if (platform === "zoho") {
        exportData = journal.map(entry => ({
            "Date": entry.Date,
            "Account Name": entry.Account,
            "CodeRange": getCodeRange(entry.Account),  // use general code range
            "Category": entry.Category,
            "Debit": entry.Debit,
            "Credit": entry.Credit,
            "Description": entry.Description
        }));
    } else if (platform === "quickbooks") {
        exportData = journal.map(entry => ({
            "TxnDate": entry.Date,
            "Account": entry.Account,
            "CodeRange": getCodeRange(entry.Account),  // use general code range
            "Category": entry.Category,
            "Debit": entry.Debit,
            "Credit": entry.Credit,
            "Memo": entry.Description
        }));
    } else if (platform === "sage") {
        exportData = journal.map(entry => ({
            "Date": entry.Date,
            "NominalCodeRange": getCodeRange(entry.Account), // use general code range
            "Category": entry.Category,
            "Description": entry.Description,
            "DebitAmount": entry.Debit || 0,
            "CreditAmount": entry.Credit || 0
        }));
    }

    // Convert to CSV
    function convertToCSV(objArray) {
        const array = typeof objArray !== 'object' ? JSON.parse(objArray) : objArray;
        let str = '';
        const headers = Object.keys(array[0]).join(',');
        str += headers + '\r\n';

        array.forEach(item => {
            let line = [];
            for (let key in item) {
                let val = item[key] != null ? item[key] : '';
                val = `"${val.toString().replace(/"/g, '""')}"`;
                line.push(val);
            }
            str += line.join(',') + '\r\n';
        });
        return str;
    }

    // Trigger download
    const csv = convertToCSV(exportData);
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.setAttribute('download', `${platform}_Export.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    alert(`Journal exported for ${platform}!`);
}


function getCodeRange(account) {
    const code = accountMapping[account] || 0;
    const category = getAccountTypeByCode(code);
    if(category && accountCodes[category]){
        return `${accountCodes[category].min} - ${accountCodes[category].max}`;
    }
    return '';
}
function downloadSample() {
    // 1️⃣ Sample Data Sheet
    const sampleDataWithCodes = sampleData.map(row => {
        const category = getAccountTypeByCode(accountMapping[row.Account] || 0);
        const range = getCodeRange(row.Account);
        return {
            Date: row.Date,
            Description: row.Description,
            Type: row.Type,
            Amount: row.Amount,
            Account: row.Account,
            CodeRange: range,
            Category: category
        };
    });
    const wsSample = XLSX.utils.json_to_sheet(sampleDataWithCodes);

    // 2️⃣ Legend Sheet
    const legendData = [
        {Category: "Assets", CodeRange: "1000-1999"},
        {Category: "Expense", CodeRange: "2000-3999"},
        {Category: "Liabilities", CodeRange: "4000-4999"},
        {Category: "Income", CodeRange: "5000-5999"},
        {Category: "Capital", CodeRange: "6000-6999"}
    ];
    const wsLegend = XLSX.utils.json_to_sheet(legendData);

    // 3️⃣ Chart of Accounts Sheet
    const chartData = Object.entries(standardChartOfAccounts).map(([code, details]) => ({
        Code: code,
        Name: details.name,
        Category: details.category,
        Type: details.type
    }));
    const wsChart = XLSX.utils.json_to_sheet(chartData);

    // 4️⃣ Improved Account Codes Sheet
    const improvedCodesData = Object.entries(improvedAccountCodes).map(([type, info]) => ({
        Type: type,
        MinCode: info.min,
        MaxCode: info.max,
        Description: info.description
    }));
    const wsImprovedCodes = XLSX.utils.json_to_sheet(improvedCodesData);

    // 5️⃣ Improved Account Mapping Sheet
    const improvedMappingData = Object.entries(improvedAccountMapping).map(([keyword, code]) => ({
        Keyword: keyword,
        AccountCode: code
    }));
    const wsImprovedMapping = XLSX.utils.json_to_sheet(improvedMappingData);

    // 6️⃣ Create Workbook and Append All Sheets
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, wsSample, "Sample Data");
    XLSX.utils.book_append_sheet(wb, wsLegend, "Code Legend");
    XLSX.utils.book_append_sheet(wb, wsChart, "Chart of Accounts");
    XLSX.utils.book_append_sheet(wb, wsImprovedCodes, "Improved Codes");
    XLSX.utils.book_append_sheet(wb, wsImprovedMapping, "Improved Mapping");

    // 7️⃣ Export
    XLSX.writeFile(wb, "SamplePettyCash_FullGuide.xlsx");
}



function openTab(evt, tabName) {
    // Hide all tab contents
    const tabContents = document.getElementsByClassName("tabContent");
    for (let i = 0; i < tabContents.length; i++) tabContents[i].style.display = "none";

    // Remove active class
    const tabButtons = document.getElementsByClassName("tabButton");
    for (let i = 0; i < tabButtons.length; i++) tabButtons[i].classList.remove("active");

    // Show selected tab
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.classList.add("active");

    // Only display if data exists
    if (tabName === "journalTab" && journal.length > 0) displayJournal();
    if (tabName === "ledgerTab" && Object.keys(ledger).length > 0) displayLedger();
}


 window.onload = function() {
    populateSample();
    document.getElementById("sampleTab").style.display = "block"; // Show first tab
};




</script>


</body>
</html>





















