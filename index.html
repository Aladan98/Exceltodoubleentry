<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Petty Cash Accounting Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; margin: 0; }
  header { background: #2c3e50; color: white; padding: 15px 20px; font-size: 1.5rem; font-weight: bold; }
  main { display: flex; padding: 20px; gap: 20px; }
  .sidebar { width: 220px; background: #34495e; padding: 15px; border-radius: 10px; color: white; display: flex; flex-direction: column; gap: 10px; }
  .sidebar button, .sidebar input { padding: 10px; font-size: 1rem; border-radius: 5px; border: none; cursor: pointer; }
  .sidebar button { background: #1abc9c; color: white; transition: 0.2s; }
  .sidebar button:hover { background: #16a085; }
  .content { flex: 1; display: flex; flex-direction: column; gap: 20px; }
  table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
  th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
  th { background: #2980b9; color: white; position: sticky; top: 0; }
  tr:nth-child(even) { background: #f0f0f0; }
  tr:hover { background: #d1ecf1; }
  .scrollable { max-height: 300px; overflow-y: auto; border-radius: 10px; }
  .debit { color: green; font-weight: bold; }
  .credit { color: red; font-weight: bold; }
</style>
</head>
<body>

<header>Petty Cash Accounting Software</header>
<main>
  <div class="sidebar">
    <input type="text" id="counterAccount" placeholder="Counter Account e.g. Bank">
    <input type="file" id="fileInput" accept=".xlsx,.csv">
    <button onclick="loadExcel()">Load Excel</button>
    <button onclick="generateJournal()">Generate Journal</button>
    <button onclick="generateLedger()">Generate General Ledger</button>
    <button onclick="downloadJournal()">Download Journal</button>
    <button onclick="downloadLedger()">Download Ledger</button>
    <button onclick="downloadSample()">Download Sample Excel</button>
  </div>

  <div class="content">
    <h2>Sample Excel Preview</h2>
    <div class="scrollable">
      <table id="sampleTable">
        <tr><th>Date</th><th>Description</th><th>Type</th><th>Amount</th><th>Account</th></tr>
      </table>
    </div>

    <h2>Journal Entries</h2>
    <div class="scrollable">
      <table id="journalTable">
        <tr><th>Date</th><th>Account</th><th>Debit</th><th>Credit</th><th>Description</th></tr>
      </table>
    </div>

    <h2>General Ledger</h2>
    <div class="scrollable">
      <table id="ledgerTable">
        <tr><th>Account</th><th>Date</th><th>Description</th><th>Debit</th><th>Credit</th><th>Balance</th></tr>
      </table>
    </div>
  </div>
</main>

<script>
let sheetData = [];
let journal = [];
let ledger = {};

const sampleData = [
  {Date:"2025-08-01", Description:"Office Supplies Purchase", Type:"Payment", Amount:120, Account:"Stationery"},
  {Date:"2025-08-02", Description:"Staff Lunch", Type:"Payment", Amount:45, Account:"Staff Food"},
  {Date:"2025-08-03", Description:"Legal Consultation", Type:"Payment", Amount:300, Account:"Legal"},
  {Date:"2025-08-04", Description:"Product Sale", Type:"Receipt", Amount:500, Account:"Sales"},
  {Date:"2025-08-05", Description:"Car Fuel", Type:"Payment", Amount:60, Account:"Car Fix"},
  {Date:"2025-08-06", Description:"Asset Purchased – Computer", Type:"Payment", Amount:800, Account:"Assets"},
  {Date:"2025-08-07", Description:"Asset Sold – Printer", Type:"Receipt", Amount:200, Account:"Assets"},
  {Date:"2025-08-08", Description:"Discount Received", Type:"Receipt", Amount:50, Account:"Discount Received"},
  {Date:"2025-08-09", Description:"Stationery Purchase", Type:"Payment", Amount:70, Account:"Stationery"},
  {Date:"2025-08-10", Description:"Staff Snacks", Type:"Payment", Amount:30, Account:"Staff Food"},
  {Date:"2025-08-11", Description:"Sales Returned – Product A", Type:"Payment", Amount:100, Account:"Sales Returns"},
  {Date:"2025-08-12", Description:"Legal Fee", Type:"Payment", Amount:250, Account:"Legal"},
  {Date:"2025-08-13", Description:"Printing Flyers", Type:"Payment", Amount:150, Account:"Printing"},
  {Date:"2025-08-14", Description:"Misc Expenses", Type:"Payment", Amount:60, Account:"Misc"}
];

function populateSample() {
  const table = document.getElementById('sampleTable');
  sampleData.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${row.Date}</td><td>${row.Description}</td><td>${row.Type}</td><td>${row.Amount}</td><td>${row.Account}</td>`;
    table.appendChild(tr);
  });
}

populateSample();

function detectAccount(description){
  const accountKeywords = {
    "Staff Food": ["food", "canteen", "lunch", "snack"],
    "Legal": ["law", "legal", "attorney", "consultation", "fee"],
    "Stationery": ["stationery", "pen", "paper", "office supply", "notebook"],
    "Printing": ["print", "brochure", "flyer", "poster"],
    "Car Fix": ["car", "fuel", "repair", "garage"],
    "Assets": ["asset", "computer", "printer", "purchase", "sale"],
    "Sales": ["sale", "income", "revenue"],
    "Sales Returns": ["returned", "return", "refund"],
    "Discount Received": ["discount received", "rebate"],
    "Misc": []
  };
  if(!description) return "Misc";
  description = description.toLowerCase();
  for(const [account, keywords] of Object.entries(accountKeywords)){
    for(const kw of keywords){
      if(description.includes(kw)) return account;
    }
  }
  return "Misc";
}

function loadExcel() {
  const file = document.getElementById('fileInput').files[0];
  if (!file) { alert("Please select an Excel file first."); return; }
  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, {type:'array'});
    const ws = workbook.Sheets[workbook.SheetNames[0]];
    sheetData = XLSX.utils.sheet_to_json(ws);
    alert('Loaded ' + sheetData.length + ' transactions.');
  };
  reader.readAsArrayBuffer(file);
}

function generateJournal() {
  if(!sheetData.length) { alert("No data loaded!"); return; }
  const table = document.getElementById('journalTable');
  table.innerHTML = '<tr><th>Date</th><th>Account</th><th>Debit</th><th>Credit</th><th>Description</th></tr>';
  journal = [];
  const counterAccount = document.getElementById('counterAccount').value || "Petty Cash";

  sheetData.forEach(row => {
    const { Date, Description, Type, Amount, Account } = row;
    const amt = parseFloat(Amount);
    if(!Type || !amt) return;
    const accountToUse = Account || detectAccount(Description);

    if(Type.toLowerCase() === 'receipt'){
      journal.push({ Date, Account: counterAccount, Debit: amt, Credit:'', Description });
      journal.push({ Date, Account: accountToUse, Debit:'', Credit: amt, Description });
    } else {
      journal.push({ Date, Account: accountToUse, Debit: amt, Credit:'', Description });
      journal.push({ Date, Account: counterAccount, Debit:'', Credit: amt, Description });
    }
  });

  renderRows(journal, table);
}

function generateLedger() {
  if(!journal.length){ alert("Generate journal first!"); return; }
  ledger = {};
  const table = document.getElementById('ledgerTable');
  table.innerHTML = '<tr><th>Account</th><th>Date</th><th>Description</th><th>Debit</th><th>Credit</th><th>Balance</th></tr>';

  journal.forEach(jr => {
    if(!ledger[jr.Account]) ledger[jr.Account] = [];
    ledger[jr.Account].push(jr);
  });

  for(const account of Object.keys(ledger)){
    let balance = 0;
    ledger[account].forEach(jr => {
      const debit = parseFloat(jr.Debit)||0;
      const credit = parseFloat(jr.Credit)||0;
      balance += debit - credit;
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${account}</td><td>${jr.Date||''}</td><td>${jr.Description||''}</td>
                      <td class="debit">${debit||''}</td><td class="credit">${credit||''}</td><td>${balance.toFixed(2)}</td>`;
      table.appendChild(tr);
    });
  }
}

function renderRows(rows, table) {
  rows.forEach(jr => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${jr.Date||''}</td><td>${jr.Account||''}</td>
                    <td class="debit">${jr.Debit||''}</td><td class="credit">${jr.Credit||''}</td>
                    <td>${jr.Description||''}</td>`;
    table.appendChild(tr);
  });
}

function downloadSample() {
  const ws = XLSX.utils.json_to_sheet(sampleData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Sample");
  XLSX.writeFile(wb, "PettyCashSample.xlsx");
}

function downloadJournal() {
  if(!journal.length){ alert("Generate journal first!"); return; }
  const ws = XLSX.utils.json_to_sheet(journal);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Journal");
  XLSX.writeFile(wb, "Journal.xlsx");
}

function downloadLedger() {
  if(!Object.keys(ledger).length){ alert("Generate ledger first!"); return; }
  const ledgerRows = [];
  for(const acc of Object.keys(ledger)){
    let balance = 0;
    ledger[acc].forEach(jr=>{
      const debit = parseFloat(jr.Debit)||0;
      const credit = parseFloat(jr.Credit)||0;
      balance += debit - credit;
      ledgerRows.push({Account:acc, Date:jr.Date, Description:jr.Description, Debit:debit, Credit:credit, Balance:balance.toFixed(2)});
    });
  }
  const ws = XLSX.utils.json_to_sheet(ledgerRows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Ledger");
  XLSX.writeFile(wb, "Ledger.xlsx");
}

</script>
</body>
</html>
