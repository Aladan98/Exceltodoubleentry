<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Petty Cash Accounting Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
/* Modern Dark Theme */
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; background: #121212; color:#e0e0e0; }
header { background:#1f1f1f; color:#00e676; padding:15px 20px; font-size:1.5rem; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.5);}
main { display:flex; padding:20px; gap:20px; }
.sidebar { width:250px; background:#1b1b1b; padding:15px; border-radius:10px; display:flex; flex-direction:column; gap:10px; }
.sidebar input, .sidebar button { padding:10px; border-radius:5px; border:none; font-size:1rem; }
.sidebar input { background:#272727; color:#e0e0e0; }
.sidebar button { background:#00e676; color:#121212; font-weight:bold; cursor:pointer; transition:0.2s; }
.sidebar button:hover { background:#00c853; }
.content { flex:1; display:flex; flex-direction:column; gap:20px; }
table { width:100%; border-collapse:collapse; border-radius:10px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.5); }
th, td { padding:10px; text-align:left; border-bottom:1px solid #333; }
th { background:#272727; cursor:pointer; user-select:none; position:sticky; top:0; z-index:1; }
tr:nth-child(even) { background:#1a1a1a; }
tr:hover { background:#333; }
.scrollable { max-height:300px; overflow-y:auto; border-radius:10px; }
.debit { color:#4caf50; font-weight:bold; }
.credit { color:#f44336; font-weight:bold; }
</style>
</head>
<body>

<header>Petty Cash Accounting Software</header>
<main>
  <div class="sidebar">
    <input type="text" id="counterAccount" placeholder="Counter Account e.g. Petty Cash">
    <input type="file" id="fileInput" accept=".xlsx,.csv">
    <button onclick="loadExcel()">Load Excel</button>
    <button onclick="generateJournal()">Generate Journal</button>
    <button onclick="generateLedger()">Generate General Ledger</button>
    <button onclick="downloadJournal()">Download Journal</button>
    <button onclick="downloadLedger()">Download Ledger</button>
    <button onclick="downloadSample()">Download Sample Excel</button>
  </div>

  <div class="content">
    <h2>Sample Excel Preview</h2>
    <div class="scrollable">
      <table id="sampleTable">
        <tr><th>Date</th><th>Description</th><th>Type</th><th>Amount</th><th>Account</th></tr>
      </table>
    </div>

    <h2>Journal Entries</h2>
    <div class="scrollable">
      <table id="journalTable">
        <tr><th>Date</th><th>Account</th><th>Debit</th><th>Credit</th><th>Description</th></tr>
      </table>
    </div>

    <h2>General Ledger</h2>
    <div class="scrollable">
      <table id="ledgerTable">
        <tr><th>Account</th><th>Date</th><th>Description</th><th>Debit</th><th>Credit</th><th>Balance</th></tr>
      </table>
    </div>
  </div>
</main>

<script>
let sheetData = [], journal = [], ledger = {};
const sampleData = [
  {Date:"2025-08-01", Description:"Office Supplies Purchase", Type:"Payment", Amount:120, Account:"Stationery"},
  {Date:"2025-08-02", Description:"Staff Lunch", Type:"Payment", Amount:45, Account:"Staff Food"},
  {Date:"2025-08-03", Description:"Legal Consultation", Type:"Payment", Amount:300, Account:"Legal"},
  {Date:"2025-08-04", Description:"Product Sale", Type:"Receipt", Amount:500, Account:"Sales"},
  {Date:"2025-08-05", Description:"Car Fuel", Type:"Payment", Amount:60, Account:"Car Fix"},
  {Date:"2025-08-06", Description:"Asset Purchased – Computer", Type:"Payment", Amount:800, Account:"Assets"},
  {Date:"2025-08-07", Description:"Asset Sold – Printer", Type:"Receipt", Amount:200, Account:"Assets"},
  {Date:"2025-08-08", Description:"Discount Received", Type:"Receipt", Amount:50, Account:"Discount Received"},
  {Date:"2025-08-09", Description:"Stationery Purchase", Type:"Payment", Amount:70, Account:"Stationery"},
  {Date:"2025-08-10", Description:"Staff Snacks", Type:"Payment", Amount:30, Account:"Staff Food"},
  {Date:"2025-08-11", Description:"Sales Returned – Product A", Type:"Payment", Amount:100, Account:"Sales Returns"},
  {Date:"2025-08-12", Description:"Legal Fee", Type:"Payment", Amount:250, Account:"Legal"},
  {Date:"2025-08-13", Description:"Printing Flyers", Type:"Payment", Amount:150, Account:"Printing"},
  {Date:"2025-08-14", Description:"Misc Expenses", Type:"Payment", Amount:60, Account:"Misc"}
];

// Populate Sample Preview
function populateSample(){
  const table=document.getElementById('sampleTable');
  sampleData.forEach(row=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${row.Date}</td><td>${row.Description}</td><td>${row.Type}</td><td>${row.Amount}</td><td>${row.Account}</td>`;
    table.appendChild(tr);
  });
}
populateSample();

// Enhanced Account Detection with extra keywords
function detectAccount(description){
  const accountKeywords = {
    "Staff Food": ["food","canteen","lunch","snack","meal"],
    "Legal": ["law","legal","attorney","consultation","fee","counsel"],
    "Stationery": ["stationery","pen","paper","office supply","notebook","envelopes"],
    "Printing": ["print","brochure","flyer","poster","banner"],
    "Car Fix": ["car","fuel","repair","garage","service","vehicle"],
    "Assets": ["asset","computer","printer","purchase","sale","equipment"],
    "Sales": ["sale","income","revenue","delivered","sold"],
    "Sales Returns": ["returned","return","refund","damages","defective"],
    "Discount Received": ["discount received","rebate","allowance"],
    "Misc": []
  };
  if(!description) return "Misc";
  description=description.toLowerCase();
  for(const [account, keywords] of Object.entries(accountKeywords)){
    for(const kw of keywords){
      if(description.includes(kw)) return account;
    }
  }
  return "Misc";
}

// Load Excel
function loadExcel(){
  const file=document.getElementById('fileInput').files[0];
  if(!file){ alert("Please select an Excel file first."); return; }
  const reader=new FileReader();
  reader.onload=function(e){
    const data=new Uint8Array(e.target.result);
    const workbook=XLSX.read(data,{type:'array'});
    const ws=workbook.Sheets[workbook.SheetNames[0]];
    sheetData=XLSX.utils.sheet_to_json(ws);
    alert('Loaded '+sheetData.length+' transactions.');
  };
  reader.readAsArrayBuffer(file);
}

// Generate Journal
function generateJournal(){
  if(!sheetData.length){ alert("No data loaded!"); return; }
  const table=document.getElementById('journalTable');
  table.innerHTML='<tr><th>Date</th><th>Account</th><th>Debit</th><th>Credit</th><th>Description</th></tr>';
  journal=[];
  const counterAccount=document.getElementById('counterAccount').value||"Petty Cash";

  sheetData.forEach(row=>{
    const {Date, Description, Type, Amount, Account}=row;
    const amt=parseFloat(Amount);
    if(!Type || !amt) return;
    const accountToUse = Account || detectAccount(Description);

    if(Type.toLowerCase() === 'receipt'){
      journal.push({Date, Account:counterAccount, Debit:amt, Credit:'', Description});
      journal.push({Date, Account:accountToUse, Debit:'', Credit:amt, Description});
    } else {
      journal.push({Date, Account:accountToUse, Debit:amt, Credit:'', Description});
      journal.push({Date, Account:counterAccount, Debit:'', Credit:amt, Description});
    }
  });

  renderRows(journal, table);
  enableSorting();
}

// Generate Ledger
function generateLedger(){
  if(!journal.length){ alert("Generate journal first!"); return; }
  ledger={};
  const table=document.getElementById('ledgerTable');
  table.innerHTML='<tr><th>Account</th><th>Date</th><th>Description</th><th>Debit</th><th>Credit</th><th>Balance</th></tr>';

  journal.forEach(jr=>{
    if(!ledger[jr.Account]) ledger[jr.Account]=[];
    ledger[jr.Account].push(jr);
  });

  for(const account of Object.keys(ledger)){
    let balance=0;
    ledger[account].forEach(jr=>{
      const debit=parseFloat(jr.Debit)||0;
      const credit=parseFloat(jr.Credit)||0;
      balance += debit - credit;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${account}</td><td>${jr.Date}</td><td>${jr.Description}</td>
      <td class="debit">${debit||''}</td><td class="credit">${credit||''}</td><td>${balance}</td>`;
      table.appendChild(tr);
    });
  }
  enableSorting();
}

// Render Rows Utility
function renderRows(rows, table){
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.Date}</td><td>${r.Account}</td><td class="debit">${r.Debit||''}</td><td class="credit">${r.Credit||''}</td><td>${r.Description}</td>`;
    table.appendChild(tr);
  });
}

// Enable Sorting
function sortTable(tableId,colIndex,type='string'){
  const table=document.getElementById(tableId);
  const rows=Array.from(table.rows).slice(1);
  let asc=table.getAttribute('data-sort-col')!=colIndex || table.getAttribute('data-sort-asc')==='false';
  rows.sort((a,b)=>{
    let valA=a.cells[colIndex].innerText.trim();
    let valB=b.cells[colIndex].innerText.trim();
    if(type==='number'){ valA=parseFloat(valA)||0; valB=parseFloat(valB)||0; }
    if(type==='date'){ valA=new Date(valA); valB=new Date(valB); }
    return asc ? (valA>valB?1:-1) : (valA<valB?1:-1);
  });
  rows.forEach(r=>table.appendChild(r));
  table.setAttribute('data-sort-col',colIndex);
  table.setAttribute('data-sort-asc',asc);
}

function enableSorting(){
  ['journalTable','ledgerTable','sampleTable'].forEach(id=>{
    const table=document.getElementById(id);
    Array.from(table.rows[0].cells).forEach((th,i)=>{
      let type='string';
      if(th.innerText.toLowerCase().includes('debit') || th.innerText.toLowerCase().includes('credit') || th.innerText.toLowerCase().includes('balance')) type='number';
      if(th.innerText.toLowerCase().includes('date')) type='date';
      th.onclick=()=>sortTable(id,i,type);
    });
  });
}

// Download Excel
function downloadJournal(){ downloadTable('journalTable','Journal.xlsx'); }
function downloadLedger(){ downloadTable('ledgerTable','Ledger.xlsx'); }
function downloadSample(){ 
  const wb=XLSX.utils.book_new();
  const ws=XLSX.utils.json_to_sheet(sampleData);
  XLSX.utils.book_append_sheet(wb, ws, "Sample");
  XLSX.writeFile(wb, "Sample_Transactions.xlsx");
}
function downloadTable(tableId, filename){
  const table=document.getElementById(tableId);
  const ws=XLSX.utils.table_to_sheet(table);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, tableId);
  XLSX.writeFile(wb, filename);
}
</script>
</body>
</html>
